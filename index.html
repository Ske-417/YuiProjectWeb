<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Yui</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <div class="app">
    <header class="hero">
      <div class="hero-inner">
        <div class="brand">
          <div class="logo">Y</div>
          <div>
            <h1>Yui</h1>
            <p class="tag">医療従事者のための勤務トラッカー</p>
          </div>
        </div>

        <div class="auth" id="authArea">
          <!-- Login UI is now separate below (loginView). This header area will show user email or sign-out -->
          <span id="userEmail" class="muted"></span>
          <button id="signOutBtn" class="hidden small">サインアウト</button>
        </div>
      </div>
    </header>

    <!-- LOGIN VIEW (displayed until user logs in or continues as guest) -->
    <main class="container" id="loginView">
      <section class="card">
        <h2>ログイン / クラウド同期</h2>
        <p class="muted">メールアドレスでマジックリンクを送ります。リンクをクリックして戻ると自動でログインします。</p>

        <div style="margin-top:12px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <input id="emailInput" type="email" placeholder="メールアドレスを入力" style="flex:1;min-width:220px" />
          <button id="sendMagicBtn" class="primary">ログイン（Magic Link）を送る</button>
          <button id="guestBtn" class="secondary">ゲストとして続行</button>
        </div>

        <p class="muted small" id="loginHint" style="margin-top:10px"></p>
      </section>
    </main>

    <!-- MAIN APP (hidden until login or guest) -->
    <main class="container hidden" id="mainView" aria-hidden="true">
      <section class="controls card">
        <div class="row between">
          <div class="buttons">
            <button id="startBtn" class="primary">出勤</button>
            <button id="stopBtn" class="secondary" disabled>退勤</button>
          </div>
          <div class="status">
            <p>状態: <strong id="statusText">未出勤</strong></p>
            <p>経過: <span id="elapsed">00:00:00</span></p>
          </div>
        </div>

        <div class="task-section">
          <p class="muted">業務を選択（出勤中にタップ）</p>
          <div class="task-buttons" id="taskButtons"></div>
          <p class="current">現在の業務: <strong id="currentTask">-</strong></p>
        </div>

        <div class="sync-row">
          <button id="syncUpload" class="small">クラウドに同期（保存）</button>
          <button id="syncDownload" class="small">クラウドから読み込む</button>
          <span class="muted small" id="syncStatus"></span>
        </div>
      </section>

      <section class="history card">
        <div class="history-header row between">
          <h2>履歴</h2>
          <div class="history-actions">
            <button id="exportCsv">CSVエクスポート</button>
            <button id="clearHistory" class="danger">履歴を削除</button>
          </div>
        </div>
        <div id="historyList" class="history-list"></div>
      </section>
    </main>

    <div id="chartModal" class="modal hidden">
      <div class="modal-card">
        <button class="modal-close" id="closeChart">✕</button>
        <h3>勤務内訳</h3>
        <canvas id="chartCanvas" width="400" height="400"></canvas>
        <div id="chartLegend" class="chart-legend"></div>
      </div>
    </div>

    <footer class="footer">
      <p>Yui — データはブラウザのローカルストレージに保存されます。クラウド同期（Supabase）を使うと複数端末で同期できます。</p>
    </footer>

  </div>

  <!-- Supabase (UMD), Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="js/app.js"></script>
</body>
</html>

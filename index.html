<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Yui</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <div class="app">
    <header class="hero" role="banner">
      <div class="hero-inner">
        <div class="brand">
          <div class="logo" aria-hidden="true">Y</div>
          <div class="brand-texts">
            <h1>Yui</h1>
            <p class="tag">Yui — あなたの働きをやさしく、正確に記録する</p>
          </div>
        </div>

        <div class="auth" id="authArea" aria-live="polite">
          <span id="userEmail" class="muted" aria-hidden="true"></span>
          <a id="adminLink" class="small hidden" href="/admin.html" aria-hidden="true">管理画面</a>
          <button id="signOutBtn" class="hidden small" aria-hidden="true">サインアウト</button>
        </div>
      </div>
    </header>

    <!-- LOGIN VIEW -->
    <main class="container" id="loginView">
      <section class="card" aria-labelledby="loginTitle">
        <h2 id="loginTitle">ログイン / クラウド同期</h2>
        <p class="muted">メールアドレスでマジックリンクを送ります。リンクをクリックして戻ると自動でログインします。</p>

        <div class="login-controls" style="margin-top:12px;">
          <label for="emailInput" class="sr-only">メールアドレス</label>
          <input id="emailInput" type="email" placeholder="メールアドレスを入力" aria-label="メールアドレス" />
          <div class="login-buttons">
            <button id="sendMagicBtn" class="primary">ログイン（Magic Link）を送る</button>
            <button id="guestBtn" class="secondary">ゲストとして続行</button>
          </div>
        </div>

        <p class="muted small" id="loginHint" style="margin-top:10px"></p>
      </section>
    </main>

    <!-- MAIN APP (hidden until login or guest) -->
    <main class="container hidden" id="mainView" aria-hidden="true">
      <section class="controls card" aria-labelledby="controlsTitle">
        <h2 id="controlsTitle" class="sr-only">勤務操作</h2>
        <div class="row between">
          <div class="buttons" role="group" aria-label="勤務操作">
            <button id="startBtn" class="primary big-action">出勤</button>
            <button id="stopBtn" class="secondary big-action" disabled>退勤</button>
          </div>
          <div class="status" aria-live="polite">
            <p>状態: <strong id="statusText">未出勤</strong></p>
            <p>経過: <span id="elapsed">00:00:00</span></p>
          </div>
        </div>

        <div class="task-section" aria-labelledby="tasksTitle">
          <h3 id="tasksTitle" class="sr-only">業務選択</h3>
          <p class="muted">業務を選択（出勤中にタップ）</p>

          <!-- Existing task buttons -->
          <div class="task-buttons" id="taskButtons" role="list"></div>

          <!-- Add custom task -->
          <div class="task-add">
            <label for="newTaskInput" class="sr-only">新しい仕事内容</label>
            <input id="newTaskInput" type="text" placeholder="新しい仕事内容を入力" aria-label="新しい仕事内容" class="pill-small" />
            <div class="task-add-buttons">
              <button id="addTaskBtn" class="small">追加</button>
              <button id="clearCustomBtn" class="small">カスタムをクリア</button>
            </div>
          </div>

          <p class="current">現在の業務: <strong id="currentTask">-</strong></p>
        </div>

        <div class="sync-row">
          <button id="syncUpload" class="small">クラウドに同期（保存）</button>
          <button id="syncDownload" class="small">クラウドから読み込む</button>
          <span class="muted small" id="syncStatus" aria-live="polite"></span>
        </div>
      </section>

      <section class="history card" aria-labelledby="historyTitle">
        <h2 id="historyTitle">履歴</h2>
        <div class="history-header row between">
          <div class="history-actions">
            <button id="exportCsv">CSVエクスポート</button>
            <button id="clearHistory" class="danger">履歴を削除</button>
          </div>
        </div>
        <div id="historyList" class="history-list" aria-live="polite"></div>
      </section>
    </main>

    <div id="chartModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="chartTitle">
      <div class="modal-card">
        <button class="modal-close" id="closeChart" aria-label="閉じる">✕</button>
        <h3 id="chartTitle">勤務内訳</h3>
        <canvas id="chartCanvas" width="400" height="400" aria-label="勤務内訳の円グラフ"></canvas>
        <div id="chartLegend" class="chart-legend" aria-hidden="false"></div>
      </div>
    </div>

    <footer class="footer" role="contentinfo">
      <p>Yui — データはブラウザのローカルストレージに保存されます。クラウド同期（Supabase）を使うと複数端末で同期できます。</p>
    </footer>

  </div>

  <!-- Scripts: supabase and chart must load before app.js -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
